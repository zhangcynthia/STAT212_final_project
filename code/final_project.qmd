---
title: "Public Transportation Accessibility in Twin Cities"
author: "Tina Chen, Shirley Jiang, Cynthia Zhang"
date: "`r format(Sys.Date(),'%e de %B, %Y')`"
format: 
  html:
    self-contained: true
editor: visual
---


### Mapping sthe Education Sources in Twin Cities

```{r}
schools_stops %>% 
  ggplot(aes(x = number_school, y = number_of_stops))+
  stat_summary_bin(fun = "mean", bins = 5, geom = "point")+ #divides the number of schools by the number of bins, so Bin 1: 0-10 schools, Bin 2: 10:20, etc. 
  geom_smooth(method = "lm")+
  labs(x = "Mean Number of Schools (Pre and Post-Secondary) in Tract", 
       y = "Mean Number of Bus Stops in Tract")+ # avg # of stops in areas with similar # of schools
  theme_classic()


schools_stops %>% 
  ggplot(aes(x = number_school, y = number_of_stops))+
  geom_point(alpha = 0.5)+
  geom_smooth(method = "lm")+
  labs(x = "Number of Schools (Pre and Post-Secondary) in Tract", y = "Number of Bus Stops in Tract")+ 
  theme_classic()
```

### function

#### map

```{r}

# need help:  don't know how to add title with var?

census_var_plot <- function(var, title){
  # using chosen variable to make the map with bus stops
  ggplot()+
  geom_sf(data = census2023, aes(fill = {{var}}))+
  geom_sf(data = stops_sf_county, color = "green", size = 0.1)+
  scale_fill_gradient(low = "orange", high = "blue")+
    labs(fill="", title = str_to_title(title))
}

census_var_perc_plot <- function(var, title){
  # using the percentage of each race  to make the map with bus stops
  ggplot()+
  geom_sf(data = census2023, aes(fill = {{var}}/population))+
  geom_sf(data = stops_sf_county, color = "green", size = 0.1)+
  scale_fill_gradient(low = "orange", high = "blue")+
   labs(fill="", title = str_c("Percentage of ",title))
}

for(i in 1:2){
  print(census_var_plot(get(name[i]), name[i]))
}


for(i in 3:9){
  print(census_var_perc_plot(get(name[i]), name[i]))
}

```

#### scatter plot

```{r warning=FALSE}

# don't know how to modify label y axis

census_point_plot <- function(var, title){
 # Function for plotting the linear relationship between chosen variables and the number of bus stops
  stops_census_join_summ %>% 
  ggplot(aes(x = {{var}}, y = number_of_stops))+
    geom_point()+
    geom_smooth(method = "lm")+
    labs(y = "Number of Bus Stops in Tract",title = str_to_title(title))+
    theme_classic()
}

census_point_density_plot <- function(var, title){
   # Function for plotting the linear relationship between
  # percentage of each ethnicity group and the number of bus stops
  stops_census_join_summ %>% 
  ggplot(aes(x = {{var}}/population, y = number_of_stops))+
    geom_point()+
    geom_smooth(method = "lm")+
    labs(y = "Number of Bus Stops in Tract", title = str_c("Percentage of ",title))+
    theme_classic()
}



for(i in 1:2){
  print(census_point_plot(get(name[i]), name[i]))
}


for(i in 3:7){
  print(census_point_density_plot(get(name[i]), name[i]))
}

```

### Overview and Covid comparison

```{r demand}
# total ridership over 5 years
used_ridership_all %>% 
  group_by(nYear) %>%
  mutate(Total_Riders = sum(Total_Riders,na.rm = TRUE)) %>% 
  ggplot(aes(x=nYear, y=Total_Riders))+
  geom_point()+
  geom_line()+
  labs(x = "Year", y = "Total Riders")
```

```{r weekday vs weekend}
# 2 comparisons included: weekday vs weekend, and among each year
weekends_weekdays %>% 
  ggplot(aes(x= nYear, y = Total_Riders)) +
  geom_point()+
  geom_line()+
  facet_wrap(~Schedule)+
  labs(x = "Year", y = "Total Riders")
```

```{r RouteType analysis}

used_ridership_all %>% filter(!(rte_class %in% c("CommRai","SuburbL","Support"))) %>% 
  group_by(nYear, rte_class) %>%
  mutate(Total_Riders = sum(Total_Riders,na.rm = TRUE)) %>% 
  ggplot(aes(x=nYear, y = Total_Riders)) +
  geom_point()+
  geom_line()+
  facet_wrap(~rte_class)+
  labs(x = "Year", y = "Total Riders")


# total ridership for BRT increase because increasing lines
used_ridership_all%>% 
  filter(rte_class == "BRT") %>% 
  distinct(nYear,Route) %>% 
  group_by(nYear) %>% 
  summarise(num_BRT = n()) %>% 
  ggplot(aes(x =nYear, y = num_BRT))+
  geom_point()+
  geom_line() # the increase of BRT can replace one of the orginal line


```

```{r route accessbility supply}
# daily load drops
used_ridership_all %>% 
  group_by(nYear) %>%
  mutate(Daily_load = n()) %>% 
  ggplot(aes(x=nYear, y= Daily_load))+
  geom_line()+
  geom_point()

# supply # of roads drops
used_ridership_all %>% 
  distinct(nYear,Route) %>% 
  group_by(nYear) %>% 
  mutate(nRoute = n()) %>% 
  ggplot(aes(x=nYear, y= nRoute))+
  geom_line()+
  geom_point()
```

```{r}
sessionInfo()
```
